<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Connection Test - Ruby Auto Parts</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè¢ Ruby Auto Parts - Supabase Connection Test</h1>
        
        <div class="info">
            <strong>Instructions:</strong> This page tests your Supabase database connection and verifies the new database structure is working correctly.
        </div>

        <div id="status"></div>
        
        <div>
            <button onclick="testConnection()">Test Connection</button>
            <button onclick="testTables()">Test Tables</button>
            <button onclick="testSampleData()">Test Sample Data</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        
        // Use the same configuration as your app
        const supabaseUrl = 'https://aknhtapidbkwksvjsqsu.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrbmh0YXBpZGJrd2tzdmpzcXN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzMTMxMzgsImV4cCI6MjA3Mzg4OTEzOH0.l3oaU9sO1HfTpLKI8xkl0gikIofmYdmW3sYKJHq3zVE';
        
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        function showResult(title, data, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.innerHTML = `
                <h3>${title}</h3>
                <div class="${type}">
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
            resultsDiv.appendChild(resultDiv);
        }
        
        window.testConnection = async function() {
            showStatus('Testing Supabase connection...', 'info');
            
            try {
                // Test basic connection
                const { data, error } = await supabase
                    .from('products')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    showStatus(`Connection failed: ${error.message}`, 'error');
                    showResult('Connection Error', error, 'error');
                } else {
                    showStatus('‚úÖ Supabase connection successful!', 'success');
                    showResult('Connection Success', { message: 'Connected to Supabase successfully' }, 'success');
                }
            } catch (err) {
                showStatus(`Connection error: ${err.message}`, 'error');
                showResult('Connection Error', err, 'error');
            }
        };
        
        window.testTables = async function() {
            showStatus('Testing database tables...', 'info');
            
            const tables = ['products', 'batches', 'inventory', 'sales', 'bills', 'suppliers'];
            const results = {};
            
            for (const table of tables) {
                try {
                    const { data, error } = await supabase
                        .from(table)
                        .select('*')
                        .limit(1);
                    
                    if (error) {
                        results[table] = { status: 'error', message: error.message };
                    } else {
                        results[table] = { status: 'success', count: data.length };
                    }
                } catch (err) {
                    results[table] = { status: 'error', message: err.message };
                }
            }
            
            const hasErrors = Object.values(results).some(r => r.status === 'error');
            showStatus(hasErrors ? '‚ùå Some tables have issues' : '‚úÖ All tables accessible!', hasErrors ? 'error' : 'success');
            showResult('Table Test Results', results, hasErrors ? 'error' : 'success');
        };
        
        window.testSampleData = async function() {
            showStatus('Testing sample data...', 'info');
            
            try {
                // Test products
                const { data: products, error: productsError } = await supabase
                    .from('products')
                    .select('*')
                    .limit(3);
                
                // Test batches
                const { data: batches, error: batchesError } = await supabase
                    .from('batches')
                    .select('*')
                    .limit(3);
                
                // Test inventory
                const { data: inventory, error: inventoryError } = await supabase
                    .from('inventory')
                    .select('*')
                    .limit(3);
                
                const results = {
                    products: productsError ? { error: productsError.message } : { count: products.length, data: products },
                    batches: batchesError ? { error: batchesError.message } : { count: batches.length, data: batches },
                    inventory: inventoryError ? { error: inventoryError.message } : { count: inventory.length, data: inventory }
                };
                
                const hasErrors = Object.values(results).some(r => r.error);
                showStatus(hasErrors ? '‚ùå Sample data issues found' : '‚úÖ Sample data loaded successfully!', hasErrors ? 'error' : 'success');
                showResult('Sample Data Test', results, hasErrors ? 'error' : 'success');
                
            } catch (err) {
                showStatus(`Sample data test error: ${err.message}`, 'error');
                showResult('Sample Data Error', err, 'error');
            }
        };
        
        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        };
        
        // Auto-test connection on page load
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>
